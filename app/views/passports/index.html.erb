<div class="selection">
  <% @passports.each do |passport| %>
    <% if passport.user_id == current_user.id %>
      <div class="passport_select">
        <% if passport.achievement != true %>
          <%= form_with scope: resource, as: resource_name, url: registration_path(resource_name), method: :patch, local: true do |f| %>

            <%= f.hidden_field :select_passport, value: passport.id %>
            <% if passport.id == passport.user.select_passport %>
              <%= f.submit passport.goal, class: "btn-true" %>
            <% else %>
              <%= f.submit passport.goal, class: "btn-false" %>
            <% end %>
          <% end %>
        <% else %>
          <div class="passport__achievement">
            <%= render partial: "achievement_passport", locals:{passport: passport} %>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>
<% @passports.each do |passport| %>
  <% if passport.achievement != true %>
    <% if passport.id == passport.user.select_passport %>
      <main class="passport">
        <section class="container">
          <div class="passport__header">
            <% if passport.genre.name == "運動" %>
              <%= image_tag 'img_passport_header_1.png' %>
            <% elsif passport.genre.name == "実践" %>
              <%= image_tag 'img_passport_header_2.png' %>
            <% elsif passport.genre.name == "睡眠" %>
              <%= image_tag 'img_passport_header_3.png' %>
            <% elsif passport.genre.name == "早起き" %>
              <%= image_tag 'img_passport_header_4.png' %>
            <% elsif passport.genre.name == "勉強" %>
              <%= image_tag 'img_passport_header_5.png' %>
            <% elsif passport.genre.name == "読書" %>
              <%= image_tag 'img_passport_header_6.png' %>
            <% elsif passport.genre.name == "ダイエット" %>
              <%= image_tag 'img_passport_header_7.png' %>
            <% elsif passport.genre.name == "瞑想" %>
              <%= image_tag 'img_passport_header_8.png' %>
            <% elsif passport.genre.name == "家事" %>
              <%= image_tag 'img_passport_header_9.png' %>
            <% elsif passport.genre.name == "悪い習慣" %>
              <%= image_tag 'img_passport_header_10.png' %>
            <% end %>
          </div>

          <div class="passport__contents">
            <div class="contents">
              <div class="habit">
                <% if passport.user_id != current_user.id %>
                  <div class="habit__user">
                    <% if passport.user_profile_image.present? %>
                      <%= image_tag passport.user.profile_image.url, class: "habit__user-icon" %>
                    <% else %>
                      <%= image_tag "icon_default_user.png", class: "habit__user-icon" %>
                    <% end %>
                    <p class="habit__user-name"><%= passport.user_name %></p>
                  </div>
                <% end %>
                <h1 class="habit__purpose"><%= simple_format(passport.purpose) %></h1>
                <h2 class="habit__goal"><%= simple_format(passport.goal) %></h2>
                <div class="habit__details">
                  <p class="period"><%= passport.start_time(passport) %> 〜 <%= passport.end_time(passport) %></p>
                  <p class="genre"><%= passport.genre.name %></p>
                </div>
                <div class="habit__rate habit__rate<%= passport.id.to_s %>">
                  <%= render partial: "passports/rate", locals: {passport: passport} %>
                </div>
                <% if passport.user_id == current_user.id %>
                  <div class="habit__btn">
                    <div class="achievement<%= passport.id.to_s %> achieveBtn">
                      <%= render partial: "passports/achievement", locals: { passport: passport } %>
                    </div>
                    <div class="edit<%= passport.id.to_s %>">
                      <%= render partial: "passports/edit", locals:{passport: passport} %>
                    </div>
                    <%= link_to user_passport_path(current_user.id, passport.id), method: :delete, data: {confirm: "本当に削除してよろしいですか？"}, class: "trash" do %>
                      <%= image_tag 'icon_trash.png' %>
                    <% end %>
                  </div>
                <% end %>
              </div>
              <% if passport.user_id == current_user.id %>
                <div class="calendar">
                  <p class="calendar__label">習慣記録</p>
                  <i class="fas fa-chevron-circle-down"></i>
                  <div class="passport-calendar passport-calendar_month<%= passport.id.to_s %>" id="month" >
                    <%= render partial: "passports/calendar_month", locals: { passport: passport, schedules: @schedules } %>
                  </div>

                  <div class="passport-calendar active passport-calendar_week<%= passport.id.to_s %>" id="week">
                    <%= render partial: "passports/calendar_week", locals: { passport: passport, schedule: @schedules}%>
                  </div>
                </div>
              <% end %>
            </div><!-- contents -->
            <div class="contents">
              <div class="methods">
                <p class="methods__label">習慣化方法</p>
                <%= render partial: "passports/psychology", collection: passport.psychologies, as: :psychology %>
                <% if passport.user_id == current_user.id %>
                  <button type="button" class="psychology-btn" data-toggle="modal" data-target="#psychologi_new_ModalLong<%= passport.id %>">
                    <span>＋</span>
                    新規登録
                  </button>
                <% end %>
              </div>
            </div><!-- contents -->
          </div>
          <div class="passport__footer">
          </div>
        </section>
      </main>


      <!-- Modal -->
      <%= form_with(model: passport, url: user_passport_path(current_user, passport.id), local: true ) do |f| %>
        <div class="modal fade psychologi_new_ModalLong" id="psychologi_new_ModalLong<%= passport.id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">習慣化方法</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true"></span>
                </button>
              </div>
              <div class="modal-body">
                <%= f.collection_check_boxes :psychology_ids, Psychology.all, :id, :title do |b| %>
                  <%= b.check_box + b.label { b.text } %>
                <% end %>
              </div>
              <div class="modal-footer">
                <%= f.submit "習慣化方法を選択", class: "btn btn-primary" %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<script>
  $('.fa-chevron-circle-down').on('click', function(){
    if($('#week').hasClass('active')) {
      $('#week').removeClass('active');
      $('#month').addClass('active');
      $('.fa-chevron-circle-down').addClass('show');
    } else if($('#month').hasClass('active')) {
      $('#month').removeClass('active');
      $('#week').addClass('active');
      $('.fa-chevron-circle-down').removeClass('show');
    }
  });
</script>
